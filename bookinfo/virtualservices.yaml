apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  ### Uncomment for sending Safari users to another version
  # - match:
    # - headers:
    #     baggage-user-agent:
    #       regex: .*Safari.*
    # route:
    # - destination:
    #     host: reviews
    #     subset: v2
  ###
  - route:
    - destination:
        host: reviews
        subset: v1
      weight: 100
  ### Uncomment for mirroring traffic to
    # mirror:
    #   host: reviews
    #   subset: v2
  ###
---


##### 1 version specific for Safari, use with curl -A Safari #####
# apiVersion: networking.istio.io/v1alpha3
# kind: VirtualService
# metadata:
#   name: reviews
# spec:
#   hosts:
#   - reviews
#   http:
#   - match:
#     - headers:
#         baggage-user-agent:
#           regex: .*Safari.*
#     route:
#     - destination:
#         host: reviews
#         subset: v2
#   - route:
#     - destination:
#         host: reviews
#         subset: v1
# ---

##### Traffic Mirroring #####
# apiVersion: networking.istio.io/v1alpha3
# kind: VirtualService
# metadata:
#   name: reviews
# spec:
#   hosts:
#   - reviews
#   http:
#   - route:
#     - destination:
#         host: reviews
#         subset: v1
#     mirror:
#       host: reviews
#       subset: v2
# ---

##### For random load balancing #####
# apiVersion: networking.istio.io/v1alpha3
# kind: DestinationRule
# metadata:
#   name: reviews
# spec:
#   host: reviews
#   trafficPolicy:
#     loadBalancer:
#       simple: RANDOM
# ---